var GMCLT=GMCLT||{},apiUrl="http://api2.1079thelink.com",gmcltStationName="WLNK",gmcltStationID=1,gmcltPlayerBackgroundImages=[],gmcltPlayerBackgroundCurrentIndex=0;jQuery(document).ready(function(){$(window).width()>=768&&GMCLT.PlayerBackground.init()}),GMCLT.PlayerBackground=function(){var a=function(){jQuery.getJSON(apiUrl+"/playerBackground/player.cfc?method=getPlayerBackgrounds&station=wlnk&callback=?",function(a){gmcltPlayerBackgroundImages=a,b()}).fail(function(){})},b=function(){var a="url("+gmcltPlayerBackgroundImages[gmcltPlayerBackgroundCurrentIndex].img+")";jQuery(".live-stream").css({"background-image":a}),gmcltPlayerBackgroundCurrentIndex<gmcltPlayerBackgroundImages.length-1?gmcltPlayerBackgroundCurrentIndex+=1:gmcltPlayerBackgroundCurrentIndex=0,setTimeout(b,5e3)},c={init:a};return c}(),"undefined"!=typeof Handlebars,GMCLT.AdIndex=function(){var a=function(){$advertiserSearch=jQuery(document.getElementById("gmclt_advertiserSearch")),$wideColumnContent=jQuery(document.getElementById("gmclt_wideColumnContent")),$categorySelect="",$categoryDropdown=jQuery(document.getElementById("gmclt_categoryDropdown")),Handlebars.registerHelper("inc",function(a,b){return parseInt(a)+1}),Handlebars.registerHelper("analytics",function(a){return ga("send",{hitType:"event",eventCategory:"Advertising",eventAction:"Impression",eventLabel:a}),""}),$advertiserSearch.keydown(function(a){13==a.keyCode&&b(0,"search")}),jQuery("#gmclt_searchSubmit").click(function(){b(0,"search")}),c();var a,d=[],e=document.URL.split("?")[1];if(void 0!=e){e=e.split("&");for(var f=0;f<e.length;f++)a=e[f].split("="),d.push(a[1]),d[a[0]]=a[1]}d.advertiserId&&b(d.advertiserId,"direct")},b=function(a,b){var c=jQuery.trim($advertiserSearch.val()),e=jQuery("#searchResults-template").html(),f=Handlebars.compile(e),g=!1,h="";switch(b){case"search":h=apiUrl+"/adIndex/adIndex.cfc?method=searchIndex&query="+c+"&mode="+b+"&station="+gmcltStationName+"&callback=?",c.length&&(g=!0);break;case"category":h=apiUrl+"/adIndex/adIndex.cfc?method=searchIndex&categoryId="+a+"&mode="+b+"&station="+gmcltStationName+"&callback=?",g=!0;break;case"direct":h=apiUrl+"/adIndex/adIndex.cfc?method=searchIndex&advertiserId="+a+"&mode="+b+"&station="+gmcltStationName+"&callback=?",$categoryDropdown.hide(),jQuery(".gmclt_searchBar").hide(),g=!0}g&&(jQuery(".gmclt_searching").show(),$wideColumnContent.html(""),jQuery.getJSON(h,function(a){$wideColumnContent.html(f(a)),jQuery(".gmclt_searching").hide(),$advertiserSearch.val(""),"category"!=b&&$categorySelect.val("0")}).fail(function(){d()}))},c=function(){var a=jQuery("#category-template").html(),c=Handlebars.compile(a);jQuery.getJSON(apiUrl+"/adIndex/adIndex.cfc?method=getCategories&stationId="+gmcltStationID+"&callback=?",function(a){$categoryDropdown.html(c(a)),$categorySelect=jQuery(document.getElementById("gmclt_categorySelect")),$categorySelect.change(function(){b($(this).attr("value"),"category")})}).fail(function(){})},d=function(){var a=jQuery("#error-template").html(),b=Handlebars.compile(a);$wideColumnContent.html(b()),jQuery(".gmclt_searching").hide(),jQuery(".gmclt_searchBar").hide()},e={init:a};return e}();var trafficmap,infowindow;GMCLT.Traffic=function(){var a=function(){var a=new google.maps.LatLng(35.2269,-80.8433),c={zoom:11,scrollwheel:!1,center:a};trafficmap=new google.maps.Map(document.getElementById("gmclt_trafficMapCanvas"),c),trafficLayer=new google.maps.TrafficLayer,trafficLayer.setMap(trafficmap),b()},b=function(){var a=jQuery("#list-template").html(),b=Handlebars.compile(a);infowindow=new google.maps.InfoWindow({content:"Test content"}),jQuery.getJSON(apiUrl+"/traffic/traffic.cfc?method=getActiveIncidents&callback=?",function(a){for(var d=0;d<a.length;d++){var e=a[d].incidentId,f=new google.maps.LatLng(a[d].lat,a[d].lng),g=a[d].marker,h=a[d].headline,i=a[d].zindex;window["marker"+e]=new google.maps.Marker({position:f,map:trafficmap,icon:iconPath+g,title:h,zIndex:i}),google.maps.event.addListener(window["marker"+e],"click",c(a[d])),jQuery("#gmclt_trafficList").html(b(a)),jQuery("#gmclt_trafficListLoading").hide()}jQuery("#gmcltTraffic_mapLoading").hide()}).fail(function(){d("map")})},c=function(a){return function(){var b=a.incidentId,c=a.body,d=a.headline,e=a.marker,f=a.dateString;infowindow.setContent("<h3><img src='"+iconPath+e+"' align='left' style='padding: 10px;' vspace='2' hspace='2'>"+d+"</h3><p class='attribution'>"+f+"</p><p>"+c+"</p>"),infowindow.open(trafficmap,window["marker"+b])}},d=function(a){var b=jQuery("#error-template").html(),c=Handlebars.compile(b);jQuery("#traffic-map-canvas").html(c()),jQuery("#gmcltTraffic_"+a+"Loading").hide()},e={init:a};return e}(),GMCLT.Weather=function(){function a(a){geocoder=new google.maps.Geocoder,geocoder.geocode({address:a},function(a,b){if(b==google.maps.GeocoderStatus.OK){var c={zoom:8,scrollwheel:!1,center:a[0].geometry.location,mapTypeId:google.maps.MapTypeId.ROADMAP},d=new google.maps.Map(document.getElementById("gmclt_radarMapCanvas"),c),e=new google.maps.ImageMapType({getTileUrl:function(a,b){return"http://mesonet.agron.iastate.edu/cache/tile.py/1.0.0/nexrad-n0q-900913/"+b+"/"+a.x+"/"+a.y+".png?"+(new Date).getTime()},tileSize:new google.maps.Size(256,256),opacity:.6,name:"NEXRAD",isPng:!0});d.overlayMapTypes.push(null),d.overlayMapTypes.setAt("1",e)}})}function b(){geocoder=new google.maps.Geocoder,geocoder.geocode({address:i},function(a,b){if(b==google.maps.GeocoderStatus.OK){var d={zoom:7,scrollwheel:!1,center:a[0].geometry.location,mapTypeId:google.maps.MapTypeId.ROADMAP};e=new google.maps.Map(document.getElementById("gmclt_stormwatchMapCanvas"),d);var f=new google.maps.ImageMapType({getTileUrl:function(a,b){return"http://mesonet.agron.iastate.edu/cache/tile.py/1.0.0/nexrad-n0q-900913/"+b+"/"+a.x+"/"+a.y+".png?"+(new Date).getTime()},tileSize:new google.maps.Size(256,256),opacity:.6,name:"NEXRAD",isPng:!0});c(i),e.overlayMapTypes.push(null),e.overlayMapTypes.setAt("1",f);for(var g="NC,SC,VA,WV,TN,GA,AL,AK,AZ,AR,CA,CO,CT,DE,DC,FL,HI,ID,IL,IN,IA,KS,KY,LA,ME,MD,MA,MI,MN,MS,MO,MT,NE,NV,NH,NJ,NM,NY,ND,OH,OK,OR,PA,RI,SD,TX,UT,VT,WA,WI,WY",h=g.split(","),j=0;j<h.length;j++)h[j]!=i&&c(h[j])}else k()})}function c(a){jQuery.getJSON(apiUrl+"/weather/weather.cfc?method=getWeatherAlerts&filter=byState&location="+a+"&callback=?",function(a){for(var b=0;b<a.length;b++){for(var c=a[b].countyId,f=[],g=0;g<a[b].countyPolygon.length;g++)f.push(new google.maps.LatLng(a[b].countyPolygon[g].lat,a[b].countyPolygon[g].lng));window["alertZone"+c]=new google.maps.Polygon({paths:f,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:1,fillColor:"#FF0000",fillOpacity:.35}),window["alertZone"+c].setMap(e),google.maps.event.addListener(window["alertZone"+c],"click",d(c))}jQuery(".gmcltWX_mapLoading").hide()}).fail(function(){k()})}function d(a){return function(){var b=jQuery("#alert-template").html(),c=Handlebars.compile(b);jQuery.getJSON(apiUrl+"/weather/weather.cfc?method=getWeatherAlerts&filter=byCounty&location="+a+"&callback=?",function(a){jQuery("#gmclt_narrowColumnContent").html(c(a))}).fail(function(){k()})}}var e,f=function(){g("USNC0121"),jQuery("#gmclt_wxSearch").keydown(function(a){13==a.keyCode&&h()}),jQuery("#gmclt_wxSearchsubmit").click(function(){h()})},g=function(b){var c=jQuery("#currentConditions-template").html(),d=Handlebars.compile(c),e=jQuery("#forecastFull-template").html(),f=Handlebars.compile(e),g=jQuery("#forecast-template").html(),h=Handlebars.compile(g);jQuery.getJSON(apiUrl+"/weather/v2/weather.cfc?method=getWeatherData&locationId="+b+"&callback=?",function(b){jQuery("#gmclt_narrowColumnContent").html(d(b)),jQuery("#gmcltWX_forecastFullContent").html(f(b)),jQuery("#gmcltWX_forecastContent").html(h(b)),jQuery(".gmclt_wxSearch").show(),jQuery(".gmclt_wxLoading").hide(),jQuery("#gmclt_radarMapCanvas").show(),a(b.location+", "+b.state)}).fail(function(){k()})},h=function(){var a=jQuery.trim(jQuery("#gmclt_wxSearch").val()),b=jQuery("#searchResults-template").html(),c=Handlebars.compile(b);a.length&&(jQuery(".gmclt_wxLoading").show(),jQuery("#gmclt_narrowColumnContent").html(""),jQuery("#gmcltWX_forecastFullContent").html(""),jQuery("#gmcltWX_forecastContent").html(""),jQuery("#gmclt_radarMapCanvas").hide(),jQuery.getJSON(apiUrl+"/weather/v2/weather.cfc?method=searchLocations&queryString="+a+"&callback=?",function(a){a.match?(g(a.results[0].locationId),jQuery("#gmclt_wxSearch").val("")):(jQuery("#gmclt_narrowColumnContent").html(c(a)),jQuery(".gmclt_wxLoading").hide(),jQuery("#gmclt_wxSearch").val(""))}).fail(function(){k()}))},i="NC",j=function(){b(),google.maps.visualRefresh=!0,jQuery("#gmclt_selectState").change(function(){jQuery("#gmclt_selectState option:selected").each(function(){i=jQuery(this).val(),b()})}).change()},k=function(){var a=jQuery("#error-template").html(),b=Handlebars.compile(a);jQuery("#gmclt_narrowColumnContent").html(b()),jQuery(".gmclt_wxLoading").hide(),jQuery(".gmclt_wxSearch").hide()},l={init:f,stormwatchInit:j,populateWeatherData:g};return l}();